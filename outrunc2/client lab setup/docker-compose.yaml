version: '3.8'

services:
  endpoint1:
    image: alpine:latest
    container_name: linux_endpoint1
    command: >
      sh -c "apk add --no-cache python3 py3-pip && tail -f /dev/null"
    networks:
      lab_network:
        ipv4_address: 192.168.210.10
    hostname: endpoint1

  endpoint2:
    image: ubuntu:latest
    container_name: linux_endpoint2
    command: >
      sh -c "apt-get update && apt-get install -y python3 python3-pip && tail -f /dev/null"
    networks:
      lab_network:
        ipv4_address: 192.168.210.11
    hostname: endpoint2

  endpoint3:
    image: centos:7
    container_name: linux_endpoint3
    command: >
      sh -c "yum update -y && yum install -y python3 python3-pip && tail -f /dev/null"
    networks:
      lab_network:
        ipv4_address: 192.168.210.12
    hostname: endpoint3

  webserver:
    build:
      context: ../webserver
      dockerfile: Dockerfile
    container_name: outrun_webserver
    ports:
      - "8080:8080"
    cap_add:
      - NET_RAW
    networks:
      lab_network:
        ipv4_address: 192.168.210.13
    hostname: outrun-server
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  lab_network:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.210.0/24
          gateway: 192.168.210.1