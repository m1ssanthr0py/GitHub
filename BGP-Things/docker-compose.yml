name: docker-bgp
services:
  client:
    build:
      context: ./docker-bgp/client
      dockerfile: Dockerfile
    container_name: ashleysequeira-client
    cap_add: [NET_ADMIN, NET_RAW]
    networks:
      lan_client6:
        ipv6_address: "2001:10:10:10::99"
    healthcheck:
      test: ["CMD-SHELL", "ping -6 -c1 -W1 2001:10:10:10::10 >/dev/null 2>&1 || ping -6 -c1 -W1 2001:10:10:10::99 >/dev/null 2>&1"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 45s
    restart: unless-stopped

  as1000:
    image: quay.io/frrouting/frr:10.4.1
    container_name: ashleysequeira-as1000
    cap_add: [NET_ADMIN, NET_RAW, NET_BIND_SERVICE, SYS_ADMIN]
    sysctls:
      net.ipv6.conf.all.forwarding: "1"
    volumes:
      - ./docker-bgp/as1000/frr.conf:/etc/frr/frr.conf:ro
      - ./docker-bgp/as1000/daemons:/etc/frr/daemons:ro
      - ./docker-bgp/as1000/vtysh.conf:/etc/frr/vtysh.conf:ro
      - ./captures:/captures
    networks:
      link_1000_2000:
        ipv6_address: "2001:12:12:12::10"
      link_1000_1337:
        ipv6_address: "2001:1:33:7::10"
      lan_client6:
        ipv6_address: "2001:10:10:10::10"
    healthcheck:
      test: ["CMD-SHELL", "pidof zebra >/dev/null && pidof bgpd >/dev/null && vtysh -c 'show running' >/dev/null 2>&1"]
      interval: 10s
      timeout: 5s
      retries: 18
      start_period: 60s
    restart: unless-stopped

  as1337:
    image: quay.io/frrouting/frr:10.4.1
    container_name: ashleysequeira-as1337
    cap_add: [NET_ADMIN, NET_RAW, NET_BIND_SERVICE, SYS_ADMIN]
    sysctls:
      net.ipv6.conf.all.forwarding: "1"
    volumes:
      - ./docker-bgp/as1337/frr.conf:/etc/frr/frr.conf:ro
      - ./docker-bgp/as1337/daemons:/etc/frr/daemons:ro
      - ./docker-bgp/as1337/vtysh.conf:/etc/frr/vtysh.conf:ro
    networks:
      link_1000_1337:
        ipv6_address: "2001:1:33:7::40"
    healthcheck:
      test: ["CMD-SHELL", "pidof zebra >/dev/null && pidof bgpd >/dev/null && vtysh -c 'show running' >/dev/null 2>&1"]
      interval: 10s
      timeout: 5s
      retries: 18
      start_period: 60s
    restart: unless-stopped

  as2000:
    image: quay.io/frrouting/frr:10.4.1
    container_name: ashleysequeira-as2000
    cap_add: [NET_ADMIN, NET_RAW, NET_BIND_SERVICE, SYS_ADMIN]
    sysctls:
      net.ipv6.conf.all.forwarding: "1"
    volumes:
      - ./docker-bgp/as2000/frr.conf:/etc/frr/frr.conf:ro
      - ./docker-bgp/as2000/daemons:/etc/frr/daemons:ro
      - ./docker-bgp/as2000/vtysh.conf:/etc/frr/vtysh.conf:ro
    networks:
      link_1000_2000:
        ipv6_address: "2001:12:12:12::20"
      link_2000_3000:
        ipv6_address: "2001:23:23:23::20"
    healthcheck:
      test: ["CMD-SHELL", "pidof zebra >/dev/null && pidof bgpd >/dev/null && vtysh -c 'show running' >/dev/null 2>&1"]
      interval: 10s
      timeout: 5s
      retries: 18
      start_period: 60s
    restart: unless-stopped

  as3000:
    image: quay.io/frrouting/frr:10.4.1
    container_name: ashleysequeira-as3000
    cap_add: [NET_ADMIN, NET_RAW, NET_BIND_SERVICE, SYS_ADMIN]
    sysctls:
      net.ipv6.conf.all.forwarding: "1"
    volumes:
      - ./docker-bgp/as3000/frr.conf:/etc/frr/frr.conf:ro
      - ./docker-bgp/as3000/daemons:/etc/frr/daemons:ro
      - ./docker-bgp/as3000/vtysh.conf:/etc/frr/vtysh.conf:ro
    networks:
      link_2000_3000:
        ipv6_address: "2001:23:23:23::30"
    healthcheck:
      test: ["CMD-SHELL", "pidof zebra >/dev/null && pidof bgpd >/dev/null && vtysh -c 'show running' >/dev/null 2>&1"]
      interval: 10s
      timeout: 5s
      retries: 18
      start_period: 60s
    restart: unless-stopped

networks:
  lan_client6:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
        - subnet: "2001:10:10:10::/64"

  link_1000_2000:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
        - subnet: "2001:12:12:12::/64"

  link_1000_1337:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
        - subnet: "2001:1:33:7::/64"

  link_2000_3000:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
        - subnet: "2001:23:23:23::/64"